<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<meta name="author" content="Servicio de las Tecnologías de la Información y las Comunicaciones - Universidad de Almería">
<title>Desarrollo de aplicaciones con Docker</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Desarrollo de aplicaciones con Docker</h1>
<div class="details">
<span id="author" class="author">Servicio de las Tecnologías de la Información y las Comunicaciones - Universidad de Almería</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Tabla de contenidos</div>
<ul class="sectlevel1">
<li><a href="#trueresumen">Resumen</a></li>
<li><a href="#trueconceptos-b-sicos">1. Conceptos básicos</a>
<ul class="sectlevel2">
<li><a href="#truequ-es-docker">1.1. Qué es Docker</a></li>
<li><a href="#truedocker-vs-m-quinas-virtuales">1.2. Docker vs Máquinas virtuales</a></li>
<li><a href="#trueventajas">1.3. Ventajas</a></li>
<li><a href="#truecontenedores-e-im-genes">1.4. Contenedores e imágenes</a></li>
</ul>
</li>
<li><a href="#trueun-ejemplo-sencillo">2. Un ejemplo sencillo</a>
<ul class="sectlevel2">
<li><a href="#trueantes-de-nada">2.1. Antes de nada</a></li>
<li><a href="#truedocker-engine">2.2. Docker engine</a></li>
<li><a href="#trueel-hola-mundo">2.3. El Hola mundo</a></li>
<li><a href="#truecrear-un-contenedor-apache">2.4. Crear un contenedor Apache</a></li>
<li><a href="#truefuncionamiento-b-sico-con-docker">2.5. Funcionamiento básico con Docker</a></li>
<li><a href="#trueim-genes-interesantes-de-docker">2.6. Imágenes interesantes de Docker</a></li>
<li><a href="#trueoperaciones-sobre-contenedores">2.7. Operaciones sobre contenedores</a></li>
<li><a href="#trueresumen-de-comandos-b-sicos-para-contenedores">2.8. Resumen de comandos básicos para contenedores</a></li>
</ul>
</li>
<li><a href="#true-em-bind-mounts-em">3. <em>Bind mounts</em></a></li>
<li><a href="#truecreaci-n-de-im-genes-propias">4. Creación de imágenes propias</a>
<ul class="sectlevel2">
<li><a href="#trueel-code-dockerfile-code">4.1. El <code>Dockerfile</code></a></li>
<li><a href="#trueim-genes">4.2. Imágenes</a></li>
<li><a href="#truedistribuci-n-y-ejecuci-n-de-aplicaciones-mediante-code-dockerfile-code">4.3. Distribución y ejecución de aplicaciones mediante <code>Dockerfile</code></a></li>
<li><a href="#trueejecuci-n-de-la-aplicaci-n-a-partir-de-la-imagen-creada">4.4. Ejecución de la aplicación a partir de la imagen creada</a></li>
<li><a href="#truesubida-de-im-genes-a-docker-hub">4.5. Subida de imágenes a Docker Hub</a></li>
<li><a href="#trueresumen-de-comandos-b-sicos-para-im-genes">4.6. Resumen de comandos básicos para imágenes</a></li>
</ul>
</li>
<li><a href="#trueaplicaciones-con-varios-contenedores">5. Aplicaciones con varios contenedores</a>
<ul class="sectlevel2">
<li><a href="#trueflujo-de-trabajo-b-sico-con-docker-compose">5.1. Flujo de trabajo básico con Docker Compose</a></li>
<li><a href="#truecomandos-b-sicos-para-docker-compose">5.2. Comandos básicos para Docker Compose</a></li>
<li><a href="#trueejemplo-aplicaci-n-web-php-con-soporte-de-base-de-datos-mysql">5.3. Ejemplo: Aplicación web (PHP) con soporte de Base de datos (MySQL)</a></li>
</ul>
</li>
<li><a href="#truedesarrollo-con-docker-compose">6. Desarrollo con Docker Compose</a>
<ul class="sectlevel2">
<li><a href="#truedesarrollo-de-la-api">6.1. Desarrollo de la API</a></li>
<li><a href="#truedesarrollo-del-front">6.2. Desarrollo del front</a></li>
<li><a href="#trueconstrucci-n-de-las-im-genes">6.3. Construcción de las imágenes</a></li>
<li><a href="#trueprueba-de-la-aplicaci-n">6.4. Prueba de la aplicación</a></li>
<li><a href="#truedocker-compose-con-la-opci-n-code-build-code">6.5. Docker Compose con la opción <code>build</code></a></li>
</ul>
</li>
<li><a href="#trueotras-cosas-interesantes">7. Otras cosas interesantes</a>
<ul class="sectlevel2">
<li><a href="#trueconfiguraci-n-de-im-genes-de-base">7.1. Configuración de imágenes de base</a></li>
<li><a href="#truemicroservicios-y-contenedores">7.2. Microservicios y contenedores</a></li>
<li><a href="#trueel-ecosistema-docker">7.3. El ecosistema Docker</a></li>
<li><a href="#trueinstalar-un-registro-de-im-genes-propio">7.4. Instalar un registro de imágenes propio</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="./images/logocloudstic.png" alt="logocloudstic.png">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueresumen"><a class="anchor" href="#trueresumen"></a>Resumen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker es un proyecto open source creado en 2013 y que ha supuesto una revolución para el desarrollo y despliegue de operaciones. Docker abstrae el hardware y el sistema operativo del host ejecutando las aplicaciones en contenedores, compartimentos aislados que contienen todos los recursos para una aplicación o servicio.</p>
</div>
<div class="paragraph">
<p>En este seminario veremos cómo usar Docker para el desarrollo de aplicaciones sencillas, aprendiendo a crear servicios con <em>Docker Compose</em> y concer la técnica de desarrollo de aplicaciones multicontenedor con <em>Docker Compose</em></p>
</div>
<div class="ulist">
<div class="title">Objetivos</div>
<ul>
<li>
<p>Conocer los componentes básicos de Docker</p>
</li>
<li>
<p>Crear contenedores a partir de imágenes de Docker Hub</p>
</li>
<li>
<p>Aprender a usar <code>Dockerfile</code> para la creación de imágenes</p>
</li>
<li>
<p>Usar volúmenes para almacenamiento persistente</p>
</li>
<li>
<p>Usar <em>Docker Compose</em> para construir entornos de contenedores</p>
</li>
<li>
<p>Aprender la técnica de desarrollo de aplicaciones multicontenedor con <em>Docker Compose</em></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Disponibles los repositorios usados en este seminario:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/ualmtorres/usoBasicoDeDocker">Acceso a los ejemplos</a></p>
</li>
<li>
<p><a href="https://github.com/ualmtorres/docker_customer_catalog">Catálogo de clientes</a></p>
</li>
<li>
<p><a href="https://github.com/ualmtorres/webEstaticaBasica">Web estática básica</a></p>
</li>
<li>
<p><a href="https://github.com/ualmtorres/docker-compose-dev">Desarrollo con Docker Compose</a></p>
</li>
<li>
<p><a href="https://github.com/ualmtorres/docker-compose-build">Docker Compose con opción build</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueconceptos-b-sicos"><a class="anchor" href="#trueconceptos-b-sicos"></a>1. Conceptos básicos</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="truequ-es-docker"><a class="anchor" href="#truequ-es-docker"></a>1.1. Qué es Docker</h3>
<div class="ulist">
<ul>
<li>
<p>Docker es una plataforma para que desarrolladores y administradores puedan desarrollar, desplegar y ejecutar aplicaciones en un entorno aislado denominado contenedor.</p>
</li>
<li>
<p>Docker permite separar las aplicaciones de la infraestructura acelerando el proceso de entrega de software a producción.</p>
</li>
<li>
<p>Proyecto open source creado en 2013 que hace uso de LXC (Linux Containers). LXC es un método de virtualización de a nivel de S.O.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Docker permite empaquetar una aplicación con todas sus dependencias para que pueda ser ejecutada en plataformas diferentes. <strong>El proceso de despliegue es rápido y repetible.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Basta con ejecutar los tres comandos siguientes en una máquina con Docker instalado para tener una aplicación web que muestra un catálogo de clientes almacenados en una base de datos MySQL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ git clone https://github.com/ualmtorres/docker_customer_catalog.git
$ cd docker_customer_catalog
$ docker-compose up -d</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/CustomerCatalog.png" alt="CustomerCatalog.png">
</div>
<div class="title">Figure 1. Aplicación sencilla que muestra un listado de clientes de una base de datos</div>
</div>
<div class="paragraph">
<p>Para detener el ejemplo anterior, desde la carpeta donde se ha desplegado la aplicación ejecutaremos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker-compose down</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto eliminará todo lo que se ha creado para este ejemplo (contenedores y red de interconexión de dichos contenedores).</p>
</div>
</div>
<div class="sect2">
<h3 id="truedocker-vs-m-quinas-virtuales"><a class="anchor" href="#truedocker-vs-m-quinas-virtuales"></a>1.2. Docker vs Máquinas virtuales</h3>
<div class="imageblock">
<div class="content">
<img src="./images/DockerVsMV.png" alt="DockerVsMV.png">
</div>
<div class="title">Figure 2. Docker vs Máquinas virtuales</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Una máquina virtual proporciona un entorno con más recursos de los que necesitan la mayoría de las aplicaciones</p>
</li>
<li>
<p>Mayor número de contenedores que de MV en el mismo hardware.</p>
</li>
<li>
<p>Los contenedores se pueden ejecutar en hosts que sean máquinas virtuales.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="trueventajas"><a class="anchor" href="#trueventajas"></a>1.3. Ventajas</h3>
<div class="ulist">
<ul>
<li>
<p>Ligeros: Los contenedores comparten el kernel del host.</p>
</li>
<li>
<p>Intercambiables: Depliegue de actualizaciones en caliente.</p>
</li>
<li>
<p>Portables: Build local y ejecución en cualquier lugar.</p>
</li>
<li>
<p>Escalables: Aumento y distribución automática de réplicas de contenedores.</p>
</li>
<li>
<p>Apilables: Aumento del stack de servicios en caliente.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Docker supone una revolución en los entornos de CI/CD. Tras la actualización del repositorio de proyecto, se crean contenedores para pasar las pruebas, se construyen las nuevas imágenes y se despliega la nueva versión de la aplicación <strong>sin parada del sistema</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truecontenedores-e-im-genes"><a class="anchor" href="#truecontenedores-e-im-genes"></a>1.4. Contenedores e imágenes</h3>
<div class="ulist">
<ul>
<li>
<p>Un contenedor se lanza ejecutando una imagen.</p>
</li>
<li>
<p>Una imagen es una plantilla con las instrucciones de creación de un contenedor Docker:</p>
<div class="ulist">
<ul>
<li>
<p>Código</p>
</li>
<li>
<p>Runtime</p>
</li>
<li>
<p>Librerías</p>
</li>
<li>
<p>Variables de entorno</p>
</li>
<li>
<p>Archivos de configuración</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueun-ejemplo-sencillo"><a class="anchor" href="#trueun-ejemplo-sencillo"></a>2. Un ejemplo sencillo</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueantes-de-nada"><a class="anchor" href="#trueantes-de-nada"></a>2.1. Antes de nada</h3>
<div class="sect3">
<h4 id="trueinstalaci-n"><a class="anchor" href="#trueinstalaci-n"></a>2.1.1. Instalación:</h4>
<div class="paragraph">
<p><a href="https://docs.docker.com/install/#desktop" target="_blank">https://docs.docker.com/install/#desktop</a></p>
</div>
<div class="paragraph">
<p>Obtenemos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Daemon de docker</p>
</li>
<li>
<p>Cliente de docker</p>
</li>
<li>
<p>Docker compose</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Configuración de Shared Drices en Docker for Windows</div>
<div class="paragraph">
<p>A la hora de configurar volúmenes para poder ofrecer persistencia a los contenedodres, los discos locales han de ser accesibles desde los contenedores creados. Para ello hay que que configurar <code>Docker Desktop</code> desde la barra de menús.</p>
</div>
<div class="paragraph">
<p>Seleccionar <code>Settings | Shared Drives</code> y seleccionar las unidades que pueden ser usadas por los contenedores.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SharedDrives.png" alt="SharedDrives.png">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="truecrear-cuenta-en-docker-hub"><a class="anchor" href="#truecrear-cuenta-en-docker-hub"></a>2.1.2. Crear cuenta en Docker Hub</h4>
<div class="paragraph">
<p>Docker Hub es un registro público de imágenes (Lugar donde se almacenan imágenes): <a href="https://hub.docker.com/" target="_blank">https://hub.docker.com</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Docker Hub permite en su plan libre tener un repositorio privado de imágenes.
También permite automatizar la construcción de imágenes y su despliegue con repositorios GitHub y Bitbucket</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truedocker-engine"><a class="anchor" href="#truedocker-engine"></a>2.2. Docker engine</h3>
<div class="imageblock">
<div class="content">
<img src="./images/DockerEngine.png" alt="DockerEngine.png">
</div>
<div class="title">Figure 3. Componentes de Docker Engine</div>
</div>
</div>
<div class="sect2">
<h3 id="trueel-hola-mundo"><a class="anchor" href="#trueel-hola-mundo"></a>2.3. El Hola mundo</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker --version
Docker version 18.09.2, build 6247962

$ docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
9bb5a5d4561a: Pull complete
Digest: sha256:f5233545e43561214ca4891fd1157e1c3c563316ed8e237750d59bde73361e77
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.
....</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Registro local y Registros remotos</div>
<div class="paragraph">
<p>La creación de un contenedor se realiza a partir de una imagen. Al instalar Docker se habilitará en el sistema un registro o repositorio local de imágenes. En ese registro se almacenarán las imágenes para crear contenedores en nuestro sistema. Inicialmente el registro local de imágenes está vacío.</p>
</div>
<div class="paragraph">
<p>Cuando ejecutamos <code>docker run</code> para crear y ejecutar un contenedor, Docker busca en el registro local la imagen para crear el contenedor. Si la imagen no está disponible en nuestro registro local de imágenes, Docker la descargará desde un registro remoto (normalmente Docker Hub) a nuestro registro local y desde dicho registro local se creará el contenedor.</p>
</div>
<div class="paragraph">
<p>Por eso, al ejecutar el comando <code>docker run hello-world</code> anterior, Docker informó que no pudo encontrar la imagen <code>hello-world</code> en el registro local y procedió a la descarga (<code>pull</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
9bb5a5d4561a: Pull complete
Digest: sha256:f5233545e43561214ca4891fd1157e1c3c563316ed8e237750d59bde73361e77
Status: Downloaded newer image for hello-world:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Es posible usar otros registros diferentes a Docker Hub e incluso contar con un registro privado de imágenes. Consultar sección <a href="#trueinstalar-un-registro-de-im-genes-propio">Instalar un registro de imágenes propio</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truecrear-un-contenedor-apache"><a class="anchor" href="#truecrear-un-contenedor-apache"></a>2.4. Crear un contenedor Apache</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker run -d -p 82:80 --name apache httpd</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Descarga una imagen Apache (<code>httpd</code>) si no existe localmente, lanza un contenedor y asocia el puerto 82 del host al puerto 80 del contenedor</p>
</li>
<li>
<p><code>-d</code> lanza el contenedor en modo <em>dettached</em> y libera la terminal</p>
</li>
<li>
<p><code>-p 82:80</code> asocia el puerto local 82 al puerto 80 del contenedor</p>
</li>
<li>
<p><code>-name apache</code> asigna el nombre <code>apache</code> al contenedor para que luego se más fácil interactuar con él (p.e. para ver sus logs, iniciar una sesión interactiva, eliminarlo, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El primer puerto que aparece es el del host y el segundo el del contenedor</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>También podemos usar el parámetro <code>--name &lt;nombre&gt;</code> para darle un nombre al contenedor. De forma predeterminada, Docker asigna un nombre aleatorio a los contenedores creados. El asignar un nombre a los contenedores creados es útil para poder identificarlos más fácilmente al realizar operaciones de administración (pausa, eliminación, &#8230;&#8203;)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Apache.png" alt="Apache.png">
</div>
<div class="title">Figure 4. Contenedor ejecutando Apache</div>
</div>
</div>
<div class="sect2">
<h3 id="truefuncionamiento-b-sico-con-docker"><a class="anchor" href="#truefuncionamiento-b-sico-con-docker"></a>2.5. Funcionamiento básico con Docker</h3>
<div class="imageblock">
<div class="content">
<img src="./images/FuncionamientoBasico.png" alt="FuncionamientoBasico.png" width="100%">
</div>
<div class="title">Figure 5. Funcionamiento básico con Docker</div>
</div>
</div>
<div class="sect2">
<h3 id="trueim-genes-interesantes-de-docker"><a class="anchor" href="#trueim-genes-interesantes-de-docker"></a>2.6. Imágenes interesantes de Docker</h3>
<div class="paragraph">
<p>En <a href="https://hub.docker.com/explore/" target="_blank">https://hub.docker.com/explore/</a> se encuentran las imágenes ordenadas por popularidad. Destacamos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>alpine: Linux reducido</p>
</li>
<li>
<p>nginx: Servidor web Nginx</p>
</li>
<li>
<p>httpd: Servidor web Apache</p>
</li>
<li>
<p>ubuntu: Ubuntu</p>
</li>
<li>
<p>redis: Base de datos Redis (clave-valor)</p>
</li>
<li>
<p>mongo: Base de datos MongoDB (documentos)</p>
</li>
<li>
<p>mysql: Base de datos MySQL (relacional)</p>
</li>
<li>
<p>postgres: Base de datos PostgreSQL (relaional)</p>
</li>
<li>
<p>node: Node.js</p>
</li>
<li>
<p>registry: Registro de imágenes on-premise</p>
</li>
<li>
<p>php, elasticsearch, haproxy, wordpress, rabbitmq, python, openjdk, tomcat, jenkins, redmine, flink, spark, &#8230;&#8203;</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="trueoperaciones-sobre-contenedores"><a class="anchor" href="#trueoperaciones-sobre-contenedores"></a>2.7. Operaciones sobre contenedores</h3>
<div class="sect3">
<h4 id="truemostrar-contenedores"><a class="anchor" href="#truemostrar-contenedores"></a>2.7.1. Mostrar contenedores</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker ps
CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
99f6727e2506        httpd               "httpd-foreground"   4 seconds ago       Up 3 seconds        0.0.0.0:82-&gt;80/tcp   apache</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Los nombres generados para los contenedores son aleatorios si no se usa el parámetro <code>-name</code> al crearlos.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truedetener-y-reanudar-contenedores"><a class="anchor" href="#truedetener-y-reanudar-contenedores"></a>2.7.2. Detener y reanudar contenedores</h4>
<div class="paragraph">
<p>Primero, obtener con <code>docker ps</code> el <code>CONTAINER ID</code> o el nombre del contenedor que queremos detener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker ps
CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES
99f6727e2506        httpd               "httpd-foreground"   4 seconds ago       Up 3 seconds        0.0.0.0:82-&gt;80/tcp   apache</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Detener el contenedor</strong></p>
</div>
<div class="paragraph">
<p>Podemos detener el contenedor de dos formas, bien a partir de su nombre, que es más sencillo localizarlo, o bien a partir de su <code>CONTAINER ID</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Detener el contenedor mediante su nombre: <code>docker stop apache</code></p>
</li>
<li>
<p>Detener el contenedor mediante su nombre: <code>docker stop 99f6727e2506</code></p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Al hacer <code>docker ps</code> no se muestran los contenedores que estén detenidos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Mostrar todos los contenedores, también los detenidos</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                        PORTS                    NAMES
99f6727e2506        httpd               "httpd-foreground"       20 minutes ago      Exited (0) 2 minutes ago                               apache</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Reanudar un contenedor</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker start apache</code></pre>
</div>
</div>
<div class="paragraph">
<p>También se podría haber reanudado a partir de su <code>CONTAINER ID</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker start 99f6727e2506</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tras reanudar el contenedor, vuelve a aparecer cuando hacemos <code>docker ps</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
99f6727e2506        httpd               "httpd-foreground"       9 hours ago         Up 10 seconds       0.0.0.0:82-&gt;80/tcp       apache</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Detener todos los contenedores en ejecución</strong></p>
</div>
<div class="paragraph">
<p>Primero obtenenemos los identificadores de los contenedores en ejecución con <code>docker ps -q</code>. Ese comando lo podemos encerrar entre apóstrofes y pasar su resultado a otro comando en la misma línea.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker stop `docker ps -q`</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Iniciar una lista de contenedores</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker start 99f6727e2506 9811efbf6e45 178c2d03f2e7</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trueabrir-un-terminal-en-un-contenedor"><a class="anchor" href="#trueabrir-un-terminal-en-un-contenedor"></a>2.7.3. Abrir un terminal en un contenedor</h4>
<div class="paragraph">
<p>Se puede iniciar especificando el nombre del contenedor (<code>apache</code>) o bien su <code>CONTAINER ID</code>. En este ejemplo se abre el terminal usando el <code>CONTAINER ID</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker exec -it 99f6727e2506 bash
root@99f6727e2506:/usr/local/apache2#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se inicia una sesión como <code>root</code> en el contenedor. En la terminal del contenedor podemos ejecutar comandos del sistema operativo (<code>ls, df -h, cat /proc/cpuinfo, &#8230;&#8203;</code>). La cantidad y el tipo de comandos dependerá de la imagen usada para crear el contenedor.</p>
</div>
</div>
<div class="sect3">
<h4 id="truecopia-de-datos"><a class="anchor" href="#truecopia-de-datos"></a>2.7.4. Copia de datos</h4>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El almacenamiento en un contenedor no es persistente. Se eliminan los datos escritos en él tras su eliminación.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como ejemplo vamos a crear en nuestro host un archivo <code>index.html</code> y lo copiaremos en el contenedor para sustituir la página de inicio del servidor Apache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&lt;!-- Ejemplo de archivo index.html --&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;h1&gt;Docker es una maravilla&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora copiamos el archivo <code>index.html</code> al contenedor con <code>docker cp</code>. Se usará el nombre del contenedor o su <code>CONTAINER ID</code> para hacer referencia al contenedor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker cp index.html apache:/usr/local/apache2/htdocs/</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/CambioIndexApache.png" alt="CambioIndexApache.png">
</div>
<div class="title">Figure 6. Cambio de página de inicio</div>
</div>
</div>
<div class="sect3">
<h4 id="trueeliminaci-n-de-un-contenedor"><a class="anchor" href="#trueeliminaci-n-de-un-contenedor"></a>2.7.5. Eliminación de un contenedor</h4>
<div class="paragraph">
<p>Primero paramos el contenedor con <code>docker stop</code> y luego lo eliminamos con <code>docker rm</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker stop apache
$ docker rm apache</code></pre>
</div>
</div>
<div class="paragraph">
<p>También se puede eliminar directamente un contenedor en ejecución forzando su eliminación</p>
</div>
<div class="paragraph">
<p><code>$ docker rm -f &lt;name-or-container-id&gt;</code></p>
</div>
<div class="paragraph">
<p>Al crear un nuevo contenedor a partir de la imagen <code>httpd</code> comprobamos que la página de inicio modificada anteriormente se eliminó junto al contenedor eliminado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker run -d -p 82:80 httpd</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Podemos eliminar todos los contenedores creados a partir de una imagen con la secuencia de comandos siguiente (p.e. eliminar todos los contenedores creados a partir de una imagen <code>wordpress</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker rm -f `docker ps -a | grep "wordpress" | awk '{print $1}'`</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para eliminar todos los contenedores parados ejecutaremos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker container prune</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueresumen-de-comandos-b-sicos-para-contenedores"><a class="anchor" href="#trueresumen-de-comandos-b-sicos-para-contenedores"></a>2.8. Resumen de comandos básicos para contenedores</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh" data-lang="sh">$ docker info
$ docker version
$ docker run &lt;image&gt; // Crea un contenedor a partir de una imagen. Si no tenemos la imagen en local, la descarga
$ docker run -d -p 82:80 --name my-nginx nginx: Crea un contenedor denominado my-nginx en modo deattached accesible desde el puerto 82
$ docker stop|start &lt;name-or-id&gt;: Detiene|Continúa un contenedor
$ docker ps -a: Listado de contenedores (-a muestra también los parados)
$ docker ps -q: Listado de los ids de los contenedores
$ docker stop `docker ps -q`: Para todos los contenedores que devuelve el subcomando `docker ps -q`
$ docker rm &lt;name-or-id&gt;: Borra un contenedor si está parado
$ docker rm -f &lt;name-or-id&gt;: Fuerza el borrado de un contenedor aunque esté parado
$ docker container prune: Elimina todos los contenedores parados
$ docker exec -it &lt;name-or-id&gt; sh: Abre una terminal en el contenedor
$ docker exec &lt;name-or-id&gt; ls: Ejecuta el comando ls en el contenedor para mostrar sus archivos
$ docker cp &lt;name-or-id&gt;:./dockerenv .: Copia el fichero dockerenv del contenedor en nuestro sistema de archivos local
$ docker rm -f `docker ps -a | grep "wordpress" | awk '{print $1}'`: Eliminar todos los contenedores creados a partir de una imagen</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hay muchas <em>Cheat Sheets</em> con resumen de los comandos principales de Docker. <a href="http://dockerlabs.collabnix.com/docker/cheatsheet/">Aquí</a> puedes encontrar una que está bastante bien.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="true-em-bind-mounts-em"><a class="anchor" href="#true-em-bind-mounts-em"></a>3. <em>Bind mounts</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Un <em>bind mount</em> permite montar un archivo o directorio de nuestro sistema en un contenedor.</p>
</div>
<div class="paragraph">
<p>Dado que los contenedores no ofrecen almacenamiento persistente, todo lo que se almacene en ellos se perderá al eliminar el contenedor. A continuación se ilustran algunas situaciones habituales y cómo los <em>bind mounts</em> resultan útiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Uso de contenedores para el desarrollo de aplicaciones. El código de desarrollo estará en el sistema de archivos de nuestro host y usaremos un <em>bind mount</em> que permite ejecutar en el contenedor el código almacenado en nuestro host.</p>
</li>
<li>
<p>Uso de contenedores de bases de datos. La base de datos tiene que estar en el sistema de archivos de nuestro host y usaremos un <em>bind mount</em> para ejecutar el contenedor con la base de datos almacenada en nuestro host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los <em>bind mounts</em> (se puede usar más de uno) se definen en el momento de lanzar el contenedor con el parámetro <code>-v</code>, indicando en primer lugar la ruta del sistema de archivo local y en segundo lugar la ruta del sistema de archivos del contenedor. Por ejemplo</p>
</div>
<div class="paragraph">
<p><code>-v /home/ubuntu/webEstaticaBasica:/usr/local/apache2/htdocs</code></p>
</div>
<div class="paragraph">
<p>indica un <em>bind mount</em> que monta la carpeta local <code>/home/ubuntu/webEstaticaBasica</code> en la carpeta <code>/usr/local/apache2/htdocs</code> del contenedor.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Ilustración de un <em>bind mount</em> con una aplicación web sencilla</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear una carpeta para este ejemplo y entrar en ella.</p>
</li>
<li>
<p>Descargar este <a href="https://github.com/ualmtorres/webEstaticaBasica.git">repositorio</a>. Contiene una web estática sencilla con un único archivo (<code>index.html</code>)</p>
</li>
<li>
<p>Lanzar un contenedor Apache con un <em>bind mount</em> sobre la carpeta de la aplicación. Asignaremos el nombre <code>my-web</code> al contenedor</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ git clone https://github.com/ualmtorres/webEstaticaBasica.git
$ docker run -d \
    -p 80:80 \ <i class="conum" data-value="1"></i><b>(1)</b>
    --name my-web \ <i class="conum" data-value="2"></i><b>(2)</b>
    -v $(pwd)/webEstaticaBasica:/usr/local/apache2/htdocs \ <i class="conum" data-value="3"></i><b>(3)</b>
    httpd <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Conservar el puerto original del contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Asignar el nombre <code>my-web</code> al contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Crear un <em>bind mount</em> entre la carpeta <code>webEstaticaBasica</code> del host a la carpeta <code>/usr/local/apache2/htdocs</code> del contenedor.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Usar la imagen <code>httpd</code> de Apache</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El resultado sería el siguiente</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/webEstaticaBasica.png" alt="webEstaticaBasica.png">
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Existen varias formas de expresar el directorio actual para facilitar la especificación de la ruta local.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interfaz de comandos de Windows: <code>%cd%</code></p>
</li>
<li>
<p>Powershell, Linux y Mac OS: <code>${PWD}</code> ó <code>$(pwd)</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 2. Ilustración de <em>bind mount</em> con una base de datos MySQL</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear una carpeta para este ejemplo y entrar en ella.</p>
</li>
<li>
<p>Descargar este <a href="https://gist.githubusercontent.com/ualmtorres/eb328b653fcc5964f976b22c320dc10f/raw/448b00c44d7102d66077a393dad555585862f923/init.sql">script de inicialización de la base de datos <em>Sporting Goods</em></a></p>
</li>
<li>
<p>Lanzar un contenedor MySQL con dos <em>bind mounts</em>, uno para inyectar el archivo de inicialización anterior, y otro para la carpeta de datos</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker run -d \
    -p 3306:3306 \ <i class="conum" data-value="1"></i><b>(1)</b>
    --name my-mysql \ <i class="conum" data-value="2"></i><b>(2)</b>
    -v $(pwd)/init.sql:/docker-entrypoint-initdb.d/init.sql \ <i class="conum" data-value="3"></i><b>(3)</b>
    -v $(pwd)/data:/var/lib/mysql \ <i class="conum" data-value="4"></i><b>(4)</b>
    -e MYSQL_ROOT_PASSWORD=secret \ <i class="conum" data-value="5"></i><b>(5)</b>
    mysql <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Conservar los puertos del contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Asignar el nombre <code>my-mysql</code> al contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><em>bind mount</em> para pasar un script SQL de inicialización de una base de datos</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><em>bind mount</em> para almacenar los datos del contenedor localmente en la carpeta <code>data</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Inicialización de la contraseña del <code>root</code>. Se configura inicializando una variable de entorno en el contenedor.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Usar la imagen de MySQL</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>A partir de este ejemplo, usando un cliente local de MySQL se podría acceder al contenedor directamente como <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p>Si no se dispone de un cliente MySQL para ver si se ha inicializado correctamente la base de datos, se puede iniciar una sesión interactiva en el contenedor creado</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker exec -it my-mysql bash <i class="conum" data-value="1"></i><b>(1)</b>

root@3c51f13a1046:/# mysql -u root -p <i class="conum" data-value="2"></i><b>(2)</b>
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 9
Server version: 8.0.19 MySQL Community Server - GPL

Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; show databases; <i class="conum" data-value="3"></i><b>(3)</b>
+--------------------+
| Database           |
+--------------------+
| SG                 | <i class="conum" data-value="4"></i><b>(4)</b>
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows in set (0.01 sec)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Iniciar una sesión interactiva en el contenedor MySQL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Iniciar una sesión como <code>root</code> en MySQL. Recordar la contraseña facilitada al crear el contenedor (<code>secret</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Mostrar las bases de datos</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Base de datos inializada por el script durante la creación del contenedor</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truecreaci-n-de-im-genes-propias"><a class="anchor" href="#truecreaci-n-de-im-genes-propias"></a>4. Creación de imágenes propias</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueel-code-dockerfile-code"><a class="anchor" href="#trueel-code-dockerfile-code"></a>4.1. El <code>Dockerfile</code></h3>
<div class="ulist">
<ul>
<li>
<p>Para construir una imagen, se crea un <code>Dockerfile</code> con las instrucciones que especifican lo que va a ir en el entorno, dentro del contenedor (redes, volúmenes, puertos al exterior, archivos que se incluyen.</p>
</li>
<li>
<p>Indica cómo y con qué construir la imagen.</p>
</li>
<li>
<p>Conseguimos que el build de la aplicación definida en el contenedor se comporte de la misma forma en cualquier lugar que se ejecute. Hacemos que sea repetible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ejemplo de <code>Dockerfile</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code># Use an official Python runtime as a parent image
FROM python:2.7-slim

# Set the working directory to /app
WORKDIR /app

# Copy the current directory contents into the container at /app
ADD . /app

# Install any needed packages specified in requirements.txt
RUN pip install --trusted-host pypi.python.org -r requirements.txt

# Make port 80 available to the world outside this container
EXPOSE 80

# Define environment variable
ENV NAME World

# Run app.py when the container launches
CMD ["python", "app.py"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fragmento de <code>Dockerfile</code> para construir una imagen con Ubuntu como base y definiendo dónde se montará un volumen externo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>FROM ubuntu:latest
RUN apt-get update -y
RUN apt-get install -y python-pip python-dev
WORKDIR /app
ENV DEBUG=True
EXPOSE 80
VOLUME /data <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Crea un punto de montaje en el contenedor. A la hora de crearlo le haremos corresponder normalmente un directorio del host</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="trueim-genes"><a class="anchor" href="#trueim-genes"></a>4.2. Imágenes</h3>
<div class="ulist">
<ul>
<li>
<p>Se construyen con <code>docker build</code> a partir de un <code>Dockerfile</code></p>
</li>
<li>
<p>Se crean en un contexto (normalmente añadiendo archivos del directorio de trabajo del host a la imagen -p.e. el código fuente de la aplicación)</p>
</li>
<li>
<p>Con <code>FROM</code> (normalmente primera instrucción del <code>Dockerfile</code>) inicializamos el sistema de archivos de la imagen (p.e. si es ubuntu obtenemos el sistema de archivos de Ubuntu)</p>
</li>
<li>
<p>Muchas imágenes disponibles en Docker Hub usan Alpine (una distribución ligera de Linux) en lugar de Ubuntu, Fedora o CentOS, debido a su menor tamaño</p>
</li>
<li>
<p>Cada instrucción del <code>Dockerfile</code> genera una nueva capa (con la diferencia) en ese sistema de archivos</p>
</li>
<li>
<p>Al hacer <code>build</code> las capas existentes en el registro local no se vuelven a crear</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Una <a href="https://hub.docker.com/r/library/alpine/tags/">imagen comprimida de Alpine</a> está en torno a los 2 MB, mientras que una <a href="https://hub.docker.com/r/library/ubuntu/tags/">imagen comprimida de Ubuntu</a> está entre 40 y 80 MB</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truedistribuci-n-y-ejecuci-n-de-aplicaciones-mediante-code-dockerfile-code"><a class="anchor" href="#truedistribuci-n-y-ejecuci-n-de-aplicaciones-mediante-code-dockerfile-code"></a>4.3. Distribución y ejecución de aplicaciones mediante <code>Dockerfile</code></h3>
<div class="paragraph">
<p>Supongamos el siguiente escenario. Contamos con el código de una aplicación disponible en un repositorio. Con la ayuda de <code>Dockerfile</code> podemos crear una imagen local con todo el software y configuración que necesita la aplicación para ejecutarse y crear después un contenedor a partir de dicha imagen. El código de la aplicación podrá ser copiado directamete al contenedor o se podrá montar un volumen en el sistema de archivos del host de forma que se pueda editar el código y no se pierdan los cambios al eliminar el contenedor.</p>
</div>
<div class="paragraph">
<p>Por tanto, una buena forma de distribuir una aplicación puede ser incluir un <code>Dockerfile</code> con la configuración de software que necesita para ejecutarse junto con el código de la aplicación.</p>
</div>
<div class="paragraph">
<p>El <code>Dockerfile</code> siguiente contiene los pasos a seguir para:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crear una imagen con Apache, PHP y el framework Phalcon.</p>
</li>
<li>
<p>Incluir el código de la aplicación en el contenedor.</p>
</li>
<li>
<p>Exponer el puerto deseado.</p>
</li>
<li>
<p>Crear un punto de montaje en el contenedor. Este punto de montaje se podrá conectar al sistema de archivos del host con un <em>bind mount</em> al iniciar el contenedor.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>FROM ualmtorres/phalcon-apache-ubuntu <i class="conum" data-value="1"></i><b>(1)</b>

ADD webEstaticaBasica /var/www/html <i class="conum" data-value="2"></i><b>(2)</b>

EXPOSE 80 <i class="conum" data-value="3"></i><b>(3)</b>

VOLUME /var/www/html <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imagen de base. Incluye Apache, PHP y el framework Phalcon</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Añade el código de la carpeta <code>webEstaticaBasica</code> del sistema de archivos local a la carpeta <code>/var/www/html</code> del contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Informa del puerto en el que escucha el contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Ofrece la carpeta <code>/var/www/html</code> como punto de montaje</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Si se quieren ofrecer varios puntos de montaje se hará a través de un array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>VOLUME ["/var/www/html", "/var/log/apache2", "/etc/apache2"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si se quieren exponer varios puertos se hará enumerando la lista de puertos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>EXPOSE 80 443</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Configura tus propias imagen de base siguiendo el ejemplo del anexo <a href="#trueconfiguraci-n-de-im-genes-de-base">Configuración de imágenes de base</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En un caso sencillo, podríamos reducir a que una aplicación está formada su base de código y el entorno en el que se ejecuta. El código de esa aplicación posiblemente esté en un repositorio
Vamos a construir un contenedor a partir del código del repositorio y lo ofrezca al host como un volumen. El proceso a seguir es:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Descargar el repositorio del código de la aplicación.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ git clone https://github.com/ualmtorres/webEstaticaBasica.git</code></pre>
</div>
</div>
</li>
<li>
<p>Creación del <code>Dockerfile</code> para la construcción de la imagen.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>FROM ualmtorres/phalcon-apache-ubuntu

ADD index.html /var/www/html

EXPOSE 80

VOLUME /var/www/html</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Es buena idea incluir en el repositorio de la aplicación el <code>Dockerfile</code>. Así se contará tanto con el código de la aplicación como con las instrucciones (en forma de <code>Dockerfile</code>) para crear el contenedor de la aplicación con todo lo necesario.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><a href="#trueconstrucci-n-de-la-imagen">Construcción de la imagen</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="trueconstrucci-n-de-la-imagen"><a class="anchor" href="#trueconstrucci-n-de-la-imagen"></a>4.3.1. Construcción de la imagen</h4>
<div class="paragraph">
<p>El comando <code>docker build</code> crea una imagen nueva usando las instrucciones del <code>Dockerfile</code>.</p>
</div>
<div class="paragraph">
<p><code>$ docker build -t ualmtorres/web-estatica-basica:v0 .</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Con <code>-t</code> definimos una etiqueta o nombre de la imagen. Al construir la imagen pasa a nuestro registro local.</p>
</li>
<li>
<p>Con <code>.</code> indicamos a Docker que utilice el directorio actual como contexto para hace el <em>build</em></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Es buena práctica crear etiquetas con el nombre de usuario el Docker Hub, el nombre de la imagen y la versión.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="truelistado-de-im-genes-locales"><a class="anchor" href="#truelistado-de-im-genes-locales"></a>4.3.2. Listado de imágenes locales</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker image list
REPOSITORY                                   TAG                 IMAGE ID            CREATED             SIZE
ualmtorres/web-estatica-basica               v0                  ed27de86aa03        30 seconds ago      309MB</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueejecuci-n-de-la-aplicaci-n-a-partir-de-la-imagen-creada"><a class="anchor" href="#trueejecuci-n-de-la-aplicaci-n-a-partir-de-la-imagen-creada"></a>4.4. Ejecución de la aplicación a partir de la imagen creada</h3>
<div class="paragraph">
<p>Usaremos un <em>bind mount</em> para poder modificar el código de la aplicación y poder conservar los cambios. Posteriormente, podremos subir los cambios de la aplicación al repositorio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker run -d \
    -p 83:80 \
    --name webEstaticaBasica \
    -v $(pwd):/var/www/html \
    ualmtorres/web-estatica-basica:v0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A la hora de distribuir y actualizar aplicaciones podemos incluir la aplicación en la imagen. Con un ciclo de CI/CD tendríamos la aplicación actualizada al actualizar su repositorio.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truesubida-de-im-genes-a-docker-hub"><a class="anchor" href="#truesubida-de-im-genes-a-docker-hub"></a>4.5. Subida de imágenes a Docker Hub</h3>
<div class="paragraph">
<p>Hasta ahora la imagen creada está en el repositorio local de imágenes. Para subirla a un repositorio remoto, como Docker Hub, primero iniciaremos sesión con <code>docker login</code> y después podremos subir la imagen con el comando siguiente</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">docker push &lt;user&gt;/&lt;image&gt;:&lt;tag&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Al hacer <code>push</code> las capas que ya estén subidas no se vuelven a subir. En cuanto una instrucción del <code>Dockerfile</code> cambia una capa, invalida al resto y se volcerán a crear las capas restantes. Por tanto, colocaremos antes en el <code>Dockerfile</code> lo que menos cambie.</p>
</li>
<li>
<p>Al hacer <code>pull</code> sólo se descargan las capas nuevas.</p>
</li>
<li>
<p>Si cambiamos en el host archivos de los que se incluyen en la imagen se genera una capa nueva invalidando la caché.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker pull wordpress
$ docker run -d -p 80:80 --name my_wordpress wordpress</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueresumen-de-comandos-b-sicos-para-im-genes"><a class="anchor" href="#trueresumen-de-comandos-b-sicos-para-im-genes"></a>4.6. Resumen de comandos básicos para imágenes</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker login
$ docker run -d nginx
$ docker pull &lt;image&gt;
$ docker image ls: Lista imágenes locales
$ docker inspect &lt;image&gt;: Propiedades de una imagen
$ docker image rm &lt;image&gt;: Elimina una imagen local</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueaplicaciones-con-varios-contenedores"><a class="anchor" href="#trueaplicaciones-con-varios-contenedores"></a>5. Aplicaciones con varios contenedores</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Docker Compose es una herramienta para definir y ejecutar aplicaciones Docker con varios contenedores.</p>
</li>
<li>
<p>De forma predeterminada, usaremos un archivo <code>docker-compose.yml</code> para configurar los <em>servicios</em> de la aplicación. Los servicios son los componentes de la aplicación (p.e. un servicio para el almacenamiento de los datos y otro para el front-end)</p>
</li>
<li>
<p>En un mismo host podemos tener varios entornos aislados. Compose usa nombres de proyecto para mantener a los entornos aislados. De forma predeterminada, Compose usa el nombre del directorio desde donde se lanza la aplicación.</p>
</li>
<li>
<p><code>docker-compose --version</code> para obtener la versión y saber si está instalado.</p>
</li>
<li>
<p>Instalación desde <a href="https://docs.docker.com/compose/install">https://docs.docker.com/compose/install</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="trueflujo-de-trabajo-b-sico-con-docker-compose"><a class="anchor" href="#trueflujo-de-trabajo-b-sico-con-docker-compose"></a>5.1. Flujo de trabajo básico con Docker Compose</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Crear el archivo <code>docker-compose.yml</code> con los servicios de la aplicación (p.e. php y mysql)</p>
</li>
<li>
<p>Construir y lanzar el entorno en modo <em>dettached</em> con <code>docker-compose up -d</code></p>
</li>
<li>
<p>Echar abajo el entorno con <code>docker-compose down</code></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>El comando <code>docker-compose down</code> necesita el archivo <code>docker-compose.yml</code> para echar abajo el entorno. Por tanto, siempre tiene que ejecutarse en el directorio donde se lanzó <code>docker-compose up</code>. Sin embargo, en ocasiones cerraremos la ventana desde donde se lanzó el entorno y necesitamos alguna forma de poder recordar dónde estaba.</p>
</div>
<div class="paragraph">
<p>El script siguiente devuelve los nombres de directorio desde los que se hayan lanzado todos los entornos de Compose que se tengan en ejecución.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>docker ps --filter "label=com.docker.compose.project" -q |
    xargs docker inspect \
    --format='{{index .Config.Labels "com.docker.compose.project"}}'|
    sort |
    uniq</code></pre>
</div>
</div>
<div class="paragraph">
<p>A partir de ahí, se trata de buscar en el sistema de archivos del host los nombres de directorio devueltos.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truecomandos-b-sicos-para-docker-compose"><a class="anchor" href="#truecomandos-b-sicos-para-docker-compose"></a>5.2. Comandos básicos para Docker Compose</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh" data-lang="sh">$ docker-compose up -d      Construye y lanza el entorno en modo dettached
$ docker-compose pull       Descarga las imágenes pero no inicia los contenedores
$ docker-compose rm [-fs]   Borra los contedores parados. Con -fs los detiene y fuerza su borrado</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueejemplo-aplicaci-n-web-php-con-soporte-de-base-de-datos-mysql"><a class="anchor" href="#trueejemplo-aplicaci-n-web-php-con-soporte-de-base-de-datos-mysql"></a>5.3. Ejemplo: Aplicación web (PHP) con soporte de Base de datos (MySQL)</h3>
<div class="ulist">
<ul>
<li>
<p>Aplicación que muestra un listado de clientes almacenado en una base de datos MySQL.</p>
</li>
<li>
<p>Podemos distribuirla con un repositorio que incluya una carpeta <code>html</code> con la aplicación PHP.</p>
</li>
<li>
<p>Al iniciar el servicio MySQL se ejecutará un script de inicialización de la base de datos.</p>
</li>
<li>
<p>Usaremos volúmenes externos para la base de datos y para la aplicación web para asegurar la persistencia de los cambios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comencemos clonando el repositorio de la aplicación:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ git clone https://github.com/ualmtorres/docker_customer_catalog.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>En ese repositorio se encuentra:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un archivo <code>docker-compose.yml</code> que configura dos servicios: un servicio para almacenamiento de datos con MySQL y otro servicio para la aplicación PHP.</p>
</li>
<li>
<p>Una carpeta <code>html</code> con la aplicación. Esta carpeta será la que monte la aplicación PHP de forma que el código de la aplicación no esté almacenada en el contenedor.</p>
</li>
<li>
<p>Un script SQL <code>init.sql</code> que inicializa la base de datos de nuestra aplicación. La base de datos se almacena en nuestro host, garantizando almacenamiento persistente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>docker-compose.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">version: '2'
services:
  mysql:
    container_name: mysql <i class="conum" data-value="1"></i><b>(1)</b>
    restart: always
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: 'secret' # TODO: Change this
    ports:
      - "3306:3306"
    volumes:
      - ./data:/var/lib/mysql <i class="conum" data-value="2"></i><b>(2)</b>
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql <i class="conum" data-value="3"></i><b>(3)</b>
  php:
    container_name: php
    restart: always
    image: ualmtorres/phalcon-apache-ubuntu
    ports:
      - "80:80"
    volumes:
      - ./html:/var/www/html <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nombre del contenedor. Este será el nombre que usará el contendor de la aplicación PHP para poder acceder a este contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Montar una carpeta <code>data</code> de nuestro host en la ruta en la que el servicio <code>mysql</code> almacena la base de datos</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>La imagen de MySQL ejecutará al inicio cualquier script que encuentre en <code>/docker-entrypoint-initdb.d/</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Montar una carpeta <code>html</code> de nuestro host en la ruta en la que el servicio <code>php</code> almacena la aplicación</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para lanzar la aplicación multicontenedor ejecutaremos el comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esto creará un contenedor para cada servicio y una red para que los contenedores de los servicios se puedan comunicar entre sí. El nombre de la red vendrá determinado por el nombre del directorio desde donde se lance Docker Compose. Los contenedores podrán referenciarse unos a otros por el nombre del contenedor.</p>
</div>
<div class="paragraph">
<p>Para probar esto, abrir una sesión interactiva en el contenedor PHP y hacer <code>ping mysql</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker exec -it php bash

root@61d202a9f1bf:/app# ping mysql <i class="conum" data-value="1"></i><b>(1)</b>

PING mysql (192.168.32.3) 56(84) bytes of data.
64 bytes from mysql.docker_customer_catalog_default (192.168.32.3): icmp_seq=1 ttl=64 time=0.132 ms
64 bytes from mysql.docker_customer_catalog_default (192.168.32.3): icmp_seq=2 ttl=64 time=0.185 ms
64 bytes from mysql.docker_customer_catalog_default (192.168.32.3): icmp_seq=3 ttl=64 time=0.120 ms</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Se usa el nombre del contenedor asignado en <code>docker-compose.yml</code> para referenciarlo</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Aunque en el <code>docker-compose.yml</code> es posible asignar un nombre diferente al contenedor que al servicio al que pertenece, se recomienda usar el mismo nombre. <strong>Los contenedores desplegados con  Docker Compose realmente usan el nombre de los contenedores para referenciarse unos a otros. Por eso, para evitar consfusiones, mejor usar el mismo nombre para servicio y para contenedor.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 3. Archivo <code>index.php</code> con el código de la aplicación</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;title&gt;Web PHP-MySQL con Docker&lt;/title&gt;
  &lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class = "container"&gt;
    &lt;div class="jumbotron"&gt;
      &lt;h1 class="display-4"&gt;Docker app&lt;/h1&gt;
      &lt;p class="lead"&gt;Ejemplo de aplicacion PHP y MySQL con contenedores&lt;/p&gt;
      &lt;hr class="my-4"&gt;
      &lt;p&gt;Usa un contenedor para Apache/PHP y otro para MySQL con almacenamiento de aplicación y de datos en volúmenes externos&lt;/p&gt;
    &lt;/div&gt;
    &lt;table class="table table-striped table-responsive"&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;Name&lt;/th&gt;
          &lt;th&gt;Credit Rating&lt;/th&gt;
          &lt;th&gt;Address&lt;/th&gt;
          &lt;th&gt;City&lt;/th&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Country&lt;/th&gt;
          &lt;th&gt;Zip&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;?php
        $conexion = mysql_connect("mysql", "root", "secret"); <i class="conum" data-value="1"></i><b>(1)</b>
        mysql_select_db("SG", $conexion);

        $cadenaSQL = "select * from s_customer";
        $resultado = mysql_query($cadenaSQL);

        while ($fila = mysql_fetch_object($resultado)) {
         echo "&lt;tr&gt;&lt;td&gt; " .$fila-&gt;name .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;credit_rating .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;address .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;city .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;state .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;country .
         "&lt;/td&gt;&lt;td&gt;" . $fila-&gt;zip_code .
         "&lt;/td&gt;&lt;/tr&gt;";
       }

       ?&gt;
     &lt;/tbody&gt;
   &lt;/table&gt;
 &lt;/div&gt;
 &lt;script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"&gt;&lt;/script&gt;
 &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"&gt;&lt;/script&gt;
 &lt;script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>El nombre con el que se accede a la base de datos MySQL es el nombre del contenedor usado en <code>docker-compose.yml</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Archivo <code>init.sql</code> para inicializar la base de datos <a href="https://gist.githubusercontent.com/ualmtorres/eb328b653fcc5964f976b22c320dc10f/raw/448b00c44d7102d66077a393dad555585862f923/init.sql">Descargar init.sql</a></p>
</div>
<script src="https://gist.github.com/ualmtorres/eb328b653fcc5964f976b22c320dc10f.js"></script>
<div class="paragraph">
<p>La aplicación quedará disponible</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/CustomerCatalog.png" alt="CustomerCatalog.png" width="100%">
</div>
<div class="title">Figure 7. Aplicación web PHP que muestra listado de clientes almacenados en MySQL</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truedesarrollo-con-docker-compose"><a class="anchor" href="#truedesarrollo-con-docker-compose"></a>6. Desarrollo con Docker Compose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A la hora de desarrollar una aplicación con varios contenedores que tienen que trabajar de forma coordinada (p.e. una aplicación de frontend y backend) usaremos Docker Compose creando un servicio para cada componente (p.e. uno para el front y otro para la API). Cada uno de esos componentes es susceptible de empaquetarse como una imagen Docker. Por tanto, cada componente debería incluir su <code>Dockerfile</code> para construir su imagen correspondiente. Así, la estructura recomendada para desarrollar con Docker Compose podría ser algo parecido a esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>.
├── docker-compose.yml <i class="conum" data-value="1"></i><b>(1)</b>
├── servicio-1 <i class="conum" data-value="2"></i><b>(2)</b>
│   ├── Dockerfile <i class="conum" data-value="3"></i><b>(3)</b>
│   └── Base de código del servicio 1
├── servicio-2
│   ├── Dockerfile
│   └── Base de código del servicio 2
...
└── servicio-n
    ├── Dockerfile
    └── Base de código del servicio n</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Archivo con la configuración de ejecución</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Directorio para cada servicio/componente</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instrucciones para la creación de la imagen del servicio</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para ilustrar esto usaremos un ejemplo ficticio que desarrolle una API con calificaciones y un front para presentar los datos de la API. A continuación se muestran los pasos:</p>
</div>
<div class="sect2">
<h3 id="truedesarrollo-de-la-api"><a class="anchor" href="#truedesarrollo-de-la-api"></a>6.1. Desarrollo de la API</h3>
<div class="paragraph">
<p>Se trata de una API en PHP con Phalcon. La API contiene los datos directamente en JSON para no añadir otro componente de bases de datos al ejemplo, conseguir un ejemplo más sencillo y no perdernos en los detalles. El objetivo es ver cómo desarrollar con Docker Compose.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Desde el directorio del proyecto crear una carpeta <code>api</code> para la API.</p>
</li>
<li>
<p>Crear un archivo <a href="https://gist.github.com/ualmtorres/581e7f6f15cda4d9c7e2b04c4fca3486"><code>.htaccess</code></a> que es necesario para rescribir las rutas en las peticiones a la API</p>
</li>
<li>
<p>Crear un archivo <a href="https://gist.github.com/ualmtorres/068ce3477fbee09276a69e37b8cc664d"><code>index.php</code></a> con el código de la API.</p>
</li>
<li>
<p>Crear el <a href="https://gist.github.com/ualmtorres/efebdfef3bb159ffd55f3a4321fef443"><code>Dockerfile</code></a> con las instrucciones para crear la imagen de la API</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM ualmtorres/phalcon-apache-ubuntu <i class="conum" data-value="1"></i><b>(1)</b>

ADD . /var/www/html <i class="conum" data-value="2"></i><b>(2)</b>

VOLUME /var/www/html <i class="conum" data-value="3"></i><b>(3)</b>

EXPOSE 80 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imagen de base para la ejecución de la API. Incluye Apache, PHP y el framework Phalcon</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Incluir el código de la API en la carpeta de publicación de Apache</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Crear un punto de montaje para que se pueda tener la base de código fuera del contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Indicar el puerto por el que escucha el contenedor (80 por ser Apache)</td>
</tr>
</table>
</div>
</li>
<li>
<p>Crear en el directorio de la aplicación (un nivel por encima de <code>api</code>) el archivo <a href="https://gist.github.com/ualmtorres/dc5c2ad42f3bf5d3f625f9234c871cbf"><code>docker-compose.yml</code></a> para poder ejecutar la API.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">version: '2'
services:
  calificaciones-api:
    container_name: calificaciones-api
    restart: always
    image: ualmtorres/phalcon-apache-ubuntu <i class="conum" data-value="1"></i><b>(1)</b>
    ports:
      - "80:80"
    volumes:
      - ./api:/var/www/html <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imagen base para ejecutar la API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Volumen en el host montado en el directorio <code>/var/www/html</code> del contenedor</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Si desplegamos el <code>docker-compose.yml</code> veremos la API ejecutándose en el puerto 80</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/calificaciones-api.png" alt="calificaciones api.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="truedesarrollo-del-front"><a class="anchor" href="#truedesarrollo-del-front"></a>6.2. Desarrollo del front</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Desde el directorio del proyecto crear una carpeta <code>front</code> para el código del front.</p>
</li>
<li>
<p>Crear un archivo <a href="https://gist.github.com/ualmtorres/52811ce82117ca10bf2d58f53d54ccf4"><code>index.php</code></a> con el código del front.</p>
</li>
<li>
<p>Crear el <a href="https://gist.github.com/ualmtorres/eeb473aec54e307d5bd73f49e72b5ec4"><code>Dockerfile</code></a> con las instrucciones para crear la imagen del front</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM php:7.2-apache <i class="conum" data-value="1"></i><b>(1)</b>

ADD . /var/www/html <i class="conum" data-value="2"></i><b>(2)</b>

VOLUME /var/www/html <i class="conum" data-value="3"></i><b>(3)</b>

EXPOSE 80</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imagen de base para la ejecución del front. Incluye Apache y PHP</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Incluir el código del front en la carpeta de publicación de Apache</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Crear un punto de montaje para que se pueda tener la base de código fuera del contenedor</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Indicar el puerto por el que escucha el contenedor (80 por ser Apache)</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Modificar el archivo <code>docker-compose.yml</code> (un nivel por encima de <code>front</code>)  añadiéndole el servicio para poder ejecutar el front.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">version: '2'
services:
  calificaciones-api:
    container_name: calificaciones-api
    restart: always
    image: ualmtorres/phalcon-apache-ubuntu
    ports:
      - "80:80"
    volumes:
      - ./api:/var/www/html
  calificaciones-front: <i class="conum" data-value="1"></i><b>(1)</b>
    container_name: calificaciones-front
    restart: always
    image: php:7.2-apache <i class="conum" data-value="2"></i><b>(2)</b>
    ports:
      - "8088:80" <i class="conum" data-value="3"></i><b>(3)</b>
    volumes:
      - ./front:/var/www/html <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Servicio para el front</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Imagen base para ejecutar el front</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Mapping de puertos para el front (El 80 está ocupado con la API)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Volumen en el host montado en el directorio <code>/var/www/html</code> del contenedor</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Si volvemos a desplegar el docker-compose.yml veremos el front ejecutándose en el puerto 8088</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/calificaciones-front.png" alt="calificaciones front.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueconstrucci-n-de-las-im-genes"><a class="anchor" href="#trueconstrucci-n-de-las-im-genes"></a>6.3. Construcción de las imágenes</h3>
<div class="paragraph">
<p>Una vez desarrollados los servicios de la aplicación podríamos proceder a la construcción de sus imágenes. Se trataría de un proceso manual en el que ejecutaríamos el comando <code>docker build</code> en cada una de los directorios de los servicios desarrollados</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En el directorio de la API: <code>docker build -t ualmtorres/calificaciones-api:v0 .</code></p>
</li>
<li>
<p>En el directorio del front: <code>docker build -t ualmtorres/calificaciones-front:v0 .</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="trueprueba-de-la-aplicaci-n"><a class="anchor" href="#trueprueba-de-la-aplicaci-n"></a>6.4. Prueba de la aplicación</h3>
<div class="paragraph">
<p>Si ahora quisiéramos desplegar la aplicación con Docker Compose nos encontramos con el problema que el archivo <code>docker-compose.yml</code> usa como imagen base las imágenes base creadas para el proceso de desarrollo. Sin embargo, ahora queremos desplegar la aplicación usando las imágenes creadas para la API y el front. Este problema lo podemos solventar rápidamente creando otro archivo para Docker Compose (p.e. <a href="https://gist.github.com/ualmtorres/80068c863b2dbe31d578ffed6897219f"><code>docker-compose-produccion.yml</code></a>) y lanzar Docker Compose con ese archivo. <code>docker-compose-produccion.yml</code> incluiría las imágenes creadas montando igualmente los directorios de las bases de código de la API y del front.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yml" data-lang="yml">version: '2'
services:
  calificaciones-api:
    container_name: calificaciones-api
    restart: always
    image: ualmtorres/calificaciones-api:v0 <i class="conum" data-value="1"></i><b>(1)</b>
    ports:
      - "80:80"
    volumes:
      - ./api:/var/www/html
  calificaciones-front:
    container_name: calificaciones-front
    restart: always
    image: ualmtorres/calificaciones-front:v0 <i class="conum" data-value="2"></i><b>(2)</b>
    ports:
      - "8088:80"
    volumes:
      - ./front:/var/www/html</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Imagen de la API como base</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Imagen del front como base</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truedocker-compose-con-la-opci-n-code-build-code"><a class="anchor" href="#truedocker-compose-con-la-opci-n-code-build-code"></a>6.5. Docker Compose con la opción <code>build</code></h3>
<div class="paragraph">
<p>El tener varios archivos para Docker Compose puede resultar confuso y en algunas ocasiones nos puede llevar a errores pensando que hemos usado uno cuando realmente estábamos usando el otro. Además, la creación de imágenes en un despliegue con gran cantidad de servicios implica la construcción manual de cada una de sus imágenes.</p>
</div>
<div class="paragraph">
<p>Para evitar esta situación podemos usar la opción <code>build</code>. La opción <code>build</code> crea las imágenes a partir de los archivos <code>Dockerfile</code> que indiquemos y posteriormente crea el contenedor a partir de esa imagen. Para hacer esto, incluiremos dos paticularidades en el archivo <code>docker-compose.yml</code> con respecto a los que hemos estado usando hasta ahora:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Incluir una opción <code>build</code> que indica el contexto donde encontrar el <code>Dockerfile</code> para crear la imagen del servicio.</p>
</li>
<li>
<p>El nombre de la imagen ahora no es el nombre de la imagen de base para crear el servicio, sino el nombre que se dará a la imagen construida para desplegar el servicio.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 4. Archivo <a href="https://gist.github.com/ualmtorres/2734a52dfc6e1ea4f35bf3bc52d9c57e"><code>docker-compose.yml</code></a> para la construcción de imágenes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">version: '2'
services:
  calificaciones-api:
    build: <i class="conum" data-value="1"></i><b>(1)</b>
      context: ./api <i class="conum" data-value="2"></i><b>(2)</b>
    container_name: calificaciones-api
    restart: always
    image: ualmtorres/calificaciones-api:v0 <i class="conum" data-value="3"></i><b>(3)</b>
    ports:
      - "80:80"
    volumes:
      - ./api:/var/www/html

  calificaciones-front:
    build: <i class="conum" data-value="4"></i><b>(4)</b>
      context: ./front <i class="conum" data-value="5"></i><b>(5)</b>
    container_name: calificaciones-front
    restart: always
    image: ualmtorres/calificaciones-front:v0 <i class="conum" data-value="6"></i><b>(6)</b>
    ports:
      - "8088:80"
    volumes:
      - ./front:/var/www/html</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Opción <code>build</code> para construir la imagen</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Ruta del <code>Dockerfile</code> de la API</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Nombre para la imagen de la API</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Opción <code>build</code> para construir la imagen</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Ruta del <code>Dockerfile</code> del front</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Nombre para la imagen del front</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Para comprobar el funcionamiento de este nuevo procedimiento, eliminaremos todo rastro de lo anterior echando abajo el despliegue anterior y borrando las imágenes creadas anteriormente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker-compose down
$ docker image rm ualmtorres/calificaciones-api:v0
$ docker image rm ualmtorres/calificaciones-front:v0</code></pre>
</div>
</div>
<div class="paragraph">
<p>A continuación, basta con volver a levantar el entorno com <code>docker-compose up -d</code> y veremos como se construyen las imágenes para el despliegue de los contenedores y los servicios de Docker Compose funcionan correctamte.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/calificaciones-front.png" alt="calificaciones front.png">
</div>
</div>
<div class="paragraph">
<p>Cuando introduzcamos cambios en la base de código y queramos volver a desplegarlos sobre las imágenes podremos ejecutar cualquiera de estos dos comandos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker-compose build
$ docker-compose up --build</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueotras-cosas-interesantes"><a class="anchor" href="#trueotras-cosas-interesantes"></a>7. Otras cosas interesantes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="trueconfiguraci-n-de-im-genes-de-base"><a class="anchor" href="#trueconfiguraci-n-de-im-genes-de-base"></a>7.1. Configuración de imágenes de base</h3>
<div class="paragraph">
<p>Aquí se muestra cómo configurar una imagen con Ubuntu 18.04, PHP y el framework Phalcon. También se muestran los dos archivos auxiliares necesarios para la configuración de Apache que necesita Phalcon.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Dockerfile</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM ubuntu:18.04

ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update &amp;&amp; apt-get install -yq --no-install-recommends \
    apt-utils \
    curl \
    # Install git
    git \
    # Install apache
    apache2 \
    # Install last version of PHP
    php \
    libapache2-mod-php \
    php-mcrypt \
    php-mysql \
    php-curl \
    nano \
    ca-certificates \
    locales \
    &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*

RUN curl -s "https://packagecloud.io/install/repositories/phalcon/stable/script.deb.sh" | /bin/bash

RUN apt-get install -y php7.0-phalcon

# Set locales
RUN locale-gen en_US.UTF-8 en_GB.UTF-8 es_ES.UTF-8

COPY conf/apache2.conf /etc/apache2/apache2.conf
COPY conf/dir.conf /etc/apache2/mods-available/dir.conf

RUN a2enmod rewrite
RUN a2enmod headers
RUN service apache2 restart

EXPOSE 80 443

WORKDIR /var/www/html

RUN rm /var/www/html/index.html

HEALTHCHECK --interval=5s --timeout=3s --retries=3 CMD curl -f http://localhost || exit 1

CMD apachectl -D FOREGROUND</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 6. Archivo <code>conf/apache2.conf</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-apache" data-lang="apache">Mutex file:${APACHE_LOCK_DIR} default

PidFile ${APACHE_PID_FILE}

Timeout 300

KeepAlive On

MaxKeepAliveRequests 100

KeepAliveTimeout 5

User ${APACHE_RUN_USER}
Group ${APACHE_RUN_GROUP}

HostnameLookups Off

ErrorLog ${APACHE_LOG_DIR}/error.log

LogLevel warn

IncludeOptional mods-enabled/*.load
IncludeOptional mods-enabled/*.conf

Include ports.conf

&lt;Directory /&gt;
	Options FollowSymLinks
	AllowOverride None
	Require all denied
&lt;/Directory&gt;

&lt;Directory /usr/share&gt;
	AllowOverride None
	Require all granted
&lt;/Directory&gt;

&lt;Directory /var/www/&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Require all granted
	Header set Access-Control-Allow-Origin "*"
&lt;/Directory&gt;

AccessFileName .htaccess

&lt;FilesMatch "^\.ht"&gt;
	Require all denied
&lt;/FilesMatch&gt;

LogFormat "%v:%p %h %l %u %t \"%r\" %&gt;s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined
LogFormat "%h %l %u %t \"%r\" %&gt;s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %&gt;s %O" common
LogFormat "%{Referer}i -&gt; %U" referer
LogFormat "%{User-agent}i" agent

IncludeOptional conf-enabled/*.conf

IncludeOptional sites-enabled/*.conf</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 7. Archivo <code>conf/dir.conf</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-apache" data-lang="apache">&lt;IfModule mod_dir.c&gt;
	DirectoryIndex index.php index.html index.cgi index.pl index.xhtml index.htm
&lt;/IfModule&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truemicroservicios-y-contenedores"><a class="anchor" href="#truemicroservicios-y-contenedores"></a>7.2. Microservicios y contenedores</h3>
<div class="paragraph">
<p>Con microservicios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Establecemos un contrato, normalmente mediante una API REST, versionada para no romper funcionalidad a usuarios anteriores</p>
</li>
<li>
<p>Ocupan un tamaño reducido y suelen realizar una tarea muy concreta</p>
<div class="ulist">
<ul>
<li>
<p>Autenticación,</p>
</li>
<li>
<p>API REST. Toda la API vs cada endpoint</p>
</li>
<li>
<p>Estadísticas consumo de recursos</p>
</li>
<li>
<p>Exportar salida a central de logs</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dockerizar con cabeza</p>
<div class="ulist">
<ul>
<li>
<p>Comenzamos pasando todo nuestro sistema o MV a un contenedor Docker. Con sólo eso ya conseguimos ejecutar nuestra sistema en distintas máquinas con distintos SO y configuraciones.</p>
</li>
<li>
<p>No intentar pasar de una vez de aplicación monlítica a microservicios diminutos</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/KeepCalmAndUseDocker.png" alt="KeepCalmAndUseDocker.png" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueel-ecosistema-docker"><a class="anchor" href="#trueel-ecosistema-docker"></a>7.3. El ecosistema Docker</h3>
<div class="imageblock">
<div class="content">
<img src="./images/DockerEcosystem.png" alt="DockerEcosystem.png" width="100%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueinstalar-un-registro-de-im-genes-propio"><a class="anchor" href="#trueinstalar-un-registro-de-im-genes-propio"></a>7.4. Instalar un registro de imágenes propio</h3>
<div class="paragraph">
<p>Es posible tener un registro propio para imágenes por cuestiones de seguridad y confidencialidad. Veamos cómo crear un registro propio mediante contenedores (uno para el registro en sí y otro cono Web UI).</p>
</div>
<div class="paragraph">
<p>El ejemplo será obtener una imagen Alpine de Docker Hub y subirla a nuestro propio registro</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">// En el servidor (p.e. 192.168.65.103)
$ docker run -d -p 5000:5000 --restart always --name registry registry:2
$ docker run \
  -d \
  -e ENV_DOCKER_REGISTRY_HOST=192.168.65.103 \
  -e ENV_DOCKER_REGISTRY_PORT=5000 \
  -p 8080:80 \
  konradkleine/docker-registry-frontend:v2

// En nuestro equipo
$ docker pull alpine <i class="conum" data-value="1"></i><b>(1)</b>
$ docker image list | grep alpine <i class="conum" data-value="2"></i><b>(2)</b>
$ docker tag 3e640a41799a 192.168.65.103:5000/alpine <i class="conum" data-value="3"></i><b>(3)</b>
$ docker push 192.168.65.103:5000/alpine <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Descargar una imagen de prueba de Alpine al registro local</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Obtener el identificador de la imagen Alpine descargada (p.e. <code>3e640a41799a</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>La imagen se etiqueta añadiéndole como prefijo host:puerto de nuestro registro</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Subida de la imagen al registro</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/RegistroPropio.png" alt="RegistroPropio.png">
</div>
</div>
<div class="paragraph">
<p><a href="https://goharbor.io/">Harbor</a> es una opción muy interesante para disponer de un registro propio de imágenes. Permite definir reglas de control de acceso, analizar imágenes en busca de vulnerabilidades y añadir una firma de confianza a las imágenes.</p>
</div>
<div class="paragraph">
<p>Para subir una imagen a Harbor:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Es necesario pertenecer a un proyecto</p>
</li>
<li>
<p>Iniciar sesión</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker login &lt;harbor-server&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Etiquetar la imagen siguiendo este patrón</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker tag &lt;image&gt; &lt;server&gt;/&lt;project&gt;/&lt;image&gt;[:&lt;version&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>Subir imagen</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ docker push &lt;server&gt;/&lt;project&gt;/&lt;image&gt;[:&lt;version&gt;]</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-04-19 20:31:28 CEST
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>